apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
type: kubernetes.io/tls
data:
  tls.crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPVENDQWlHZ0F3SUJBZ0lVUTFjT3V4NVFvY21tYVFySWNjS3RRNDFpZkJRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JURUxNQWtHQTFVRUJoTUNRVlV4RXpBUkJnTlZCQWdNQ2xOdmJXVXRVM1JoZEdVeElUQWZCZ05WQkFvTQpHRWx1ZEdWeWJtVjBJRmRwWkdkcGRITWdVSFI1SUV4MFpEQWVGdzB5TkRBeU1UY3hNREk1TWpaYUZ3MHlOVEF5Ck1UWXhNREk1TWpaYU1FVXhDekFKQmdOVkJBWVRBa0ZWTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1TRXcKSHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXdnZ0VpTUEwR0NTcUdTSWIzRFFFQgpBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRRGtCOXMwd3VUcmFxQ3p3ekE4ZTlxbkYyczh1STZRUzIvaUtzaDIrWmQrCjIzUHRudXQwY2Q2Z1RtenhkNklTRVNnMUlxQWgyK3d4enAvekR5MVR5QlpIcC9tVmRqQlpWYS96SytkbUtpSEoKM1hRaDhSMGV2dUpyRkdLZk1rRE1Sd01zQ1M3MER0Q1k4LzY1dzdVbTA1LzRRaE1rU1JCTzU4Z0czZS9EQVppTAoyWUtMZjk5UzdrSlBFUnBzUFVWdmJERkpPSVZWemNsTk80ZUk4Q2VIOUdJMDE1VkV1ZlpDMElra3Zid0pUZXFlCnB3Uy9TRUZiOGx5M01KZWtaVms3Smp6YUVLejQ4VE5UbXU4U0E4TFlsZ1lDY1ZHM2MrMmRCek02L2lXdENPV2sKbHpVVHIyV3R5MDhHUjhDQmFyT3dxZzZoTkhBZHcybkNKaHh4ZGV5bkVqalZBZ01CQUFHaklUQWZNQjBHQTFVZApEZ1FXQkJUL2MyUVNZYUJ6OVora3orRDB6UzVUNEdFdUVqQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFaZ2tOCjhJc3lnMTk4aW9NMnlQak5IRFJCcHhZR1RDT09kYk1sZjF1MXNWRUl5czdxSTFleUF5Q1hzbUg1WUxqRUpSTmUKUVlBRU5jWTJYMDAxNk42ZWhWOEVPSXlUdkJiaXlNZjNZMlFXeVYzelo1Mjc0TEdBQzlRVTZiM1JNVTFTeCtNYwpScnc4cjRNZFg0enV4N0lTdlJUa2F4ZXlUbnpZNklITTMvSFQxMmkzdHhib3B4SGRIcUdYZHZXNmFxQngzaFNnCkhwVklpN0hOQmUrck92OWtpeHpBQUVKalRDRXBIa1VZT3RENTFHQWR0R0d5YmY0S1l0aEJreHpIZDFIR21GWnYKOWtvMFZvaytWK1ZsN0swM1lyYThndTJwTi9kTmtYRVBDUmI1Qyt5MU5YdlZTR0diU1dxdS83S1pVSWJNUDdpQwp4TjZIUGVURktodVU0QlYrUUE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
  tls.key: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRRGtCOXMwd3VUcmFxQ3oKd3pBOGU5cW5GMnM4dUk2UVMyL2lLc2gyK1pkKzIzUHRudXQwY2Q2Z1RtenhkNklTRVNnMUlxQWgyK3d4enAvegpEeTFUeUJaSHAvbVZkakJaVmEveksrZG1LaUhKM1hRaDhSMGV2dUpyRkdLZk1rRE1Sd01zQ1M3MER0Q1k4LzY1Cnc3VW0wNS80UWhNa1NSQk81OGdHM2UvREFaaUwyWUtMZjk5UzdrSlBFUnBzUFVWdmJERkpPSVZWemNsTk80ZUkKOENlSDlHSTAxNVZFdWZaQzBJa2t2YndKVGVxZXB3Uy9TRUZiOGx5M01KZWtaVms3Smp6YUVLejQ4VE5UbXU4UwpBOExZbGdZQ2NWRzNjKzJkQnpNNi9pV3RDT1drbHpVVHIyV3R5MDhHUjhDQmFyT3dxZzZoTkhBZHcybkNKaHh4CmRleW5FampWQWdNQkFBRUNnZ0VBQkwyZkVvMDh1aUk0M2hQZ1JGbWsxWlY0anNZZGZLVjgyWHhmTjQzLzFzelUKTDZ2K3BDaWI0c1JPb29TRXM1QjB3QW9NdnpkMXhTRlJGUG9MVExNYnQzaW9DVEh3Vm1NZ0tkT1BWNEhudXUwbQpOWEJ3VlF2TjVFRUR2ZUNMRlZRaW5qOUFvU1ZQcytaYXROejdQcWZtcXdBZ3FyLzBIVmZYUWtGSjgwbHN0UGVTCklGWnhqMVNZOGJQY01aeGxITEhjdXY5RVpPL3kvQlNxSW5BK3BmRUE2ZW9KSWF3M0ZKejQycGM0VGhzdFV4M24KaFlNZWNiUW9TVUQ5TDJ4ZktmSHhDM1YrRzM0OHJ1TGRCREtyUlF5TGIvZkViWWJEUmI3aFNZVkhRZUNmRTg4ZwovQnZCdU9hZ2RoOS95RGdoNFBnNWNIaCtva3JocEdLZm5qM050Zk1rQVFLQmdRRDZKZ2FlUksyNWN2cS9rVGFQCjZzd3QybXNQSEZ0cXIycWJWL1ZoRWkvSjNkTGVtU1hxZ0wvYksyeFlmaEFzZDY0a0RRak9oVXNRTzJDTkhTdjEKaEkwUVNYNkJaS2djOFhOdFBseTNyY1VSK05CcDR2VjZnNmlzZ1NYNHNxOGM4eGUwZlJCVVRlWHh5S3o3L05mdQpDVW5QRzY2WnhyQkVVWXA4TnNTVFJTVE8xUUtCZ1FEcFhXR1phQWl1QVd1VkcxeWdkU0VEalozeU1YMm9XNDZPCm1sQ0gyNU5sSjhZTExuanhORExKclFWUUlVWk9CVXYrTmU2cUJIckZVRU95NU9Cb1FjNFJKc2d0RmNWWDd4QWkKRmRsUGJKelEvbWtmTTgvd0MxZkJqZDJxalpYU3dpNTNibDRXKzA4c0Qzd296MTZkUFFMS1BkcnVoaU5wTjlDMApROUgxQUhEQ0FRS0JnUUNPcmdQV1lHd0t2Q2VEL3dyMUdjTHVZSWZ5TFlXREc1MGVFQlNaRXF1SlkrbzBKM3gxCi9vdndNaHR4ZWk0MWZ1b29DL3M2K05KdzVyMVNvQklEejJBNnF3RHFRd1NVeGEvRjN1MDVvM2Nsb2hzV1dtc1UKUDJhRlJvRG5FdHhKRWVzeWVxZEd2c3ZxbGtEODFpSS8xckp2M0dWQnR3K3hXQ1U2Wm03SFpZZnlKUUtCZ1FDcQpId2tuYkUvbmllR0RzWTYwNnE1R2lOYTcySmhpUTF5SldMV2NWTlgreUIvM3hza2tEWWw0dkVsRFFQNmZvZnprCk5Tem5oSng3ZXlmZklqcjF4Z01UUGRKd0M0N3hxN1YzSTdabjBDWUJ0WFdzNlhpTTViZnp3aGYyWFlEN1E5UGIKL1BsYWg1b1A1TG4raGkzVE1zYjE2R0hSd0xmUDNJQ282VWdGODJ4QUFRS0JnUUMrazR0TU9MdGVCZ0FkZWpjZgo3TDV0REN3R0plL1NETHBIcjdyYWFkQ3JPQkxSS2dVTFA4bk9IeXRYZUNiZjNCT0hVbklxNXRCWTVmSWJIbk82CktaYnV6T2l2blRJVkNvNjg5YUpFbGRidXRMS2lyamtsZXU5OVJpWk5tenpGUDJpa3NnNTBxYy9iT2dHSjd3RnIKck9xVzNtVmc5Z2hoTE56QWdkQmpPZ2QrYWc9PQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg=="
---
apiVersion: v1
kind: Service
metadata:
  name: keycloak
  labels:
    app: keycloak
spec:
  ports:
    - name: http
      port: 8080
      targetPort: 8080
  selector:
    app: keycloak
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: keycloak
  labels:
    app: keycloak
spec:
  replicas: 1
  selector:
    matchLabels:
      app: keycloak
  template:
    metadata:
      labels:
        app: keycloak
    spec:
      containers:
        - name: keycloak
          image: quay.io/keycloak/keycloak:23.0.3
          args: ["start-dev"]
          env:
            - name: KEYCLOAK_ADMIN
              value: "admin"
            - name: KEYCLOAK_ADMIN_PASSWORD
              value: "admin"
            - name: KC_PROXY
              value: "edge"
          ports:
            - name: http
              containerPort: 8080
          readinessProbe:
            httpGet:
              path: /realms/master
              port: 8080
          resources:
            limits:
              cpu: "1"
              memory: "1Gi"
            requests:
              cpu: "0.5"
              memory: "500Mi"
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: keycloak
spec:
  tls:
    - hosts:
      - keycloak.example.com
      secretName: tls-secret
  rules:
  - host: keycloak.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: keycloak
            port:
              name: http
